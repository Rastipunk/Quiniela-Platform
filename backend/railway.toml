[build]
# Desactivar cache de builds para evitar problemas con código viejo
builder = "nixpacks"

[build.nixpacks]
nixpacksVersion = "latest"

[build.env]
NIXPACKS_NODE_VERSION = "22"
NPM_CONFIG_PRODUCTION = "false"

[deploy]
# Comando que se ejecuta ANTES del deploy (ideal para migraciones)
# Esto aplica las migraciones pendientes a la base de datos de producción
releaseCommand = "npx prisma migrate deploy"
# Comando de inicio
startCommand = "npm run start"
# Health check para verificar que el deployment fue exitoso
healthcheckPath = "/health"
healthcheckTimeout = 30
# Reiniciar si falla
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
